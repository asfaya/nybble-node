var weatherService = require('../services/weatherService');

jest.mock('../services/weatherService');

const mockRequest = (lat, long) => {
    return {
        params: {
            lat: lat,
            long: long
        }
    };
};

const mockResponse = () => {
    const res = {};
    res.status = jest.fn().mockReturnValue(res);
    res.json = jest.fn().mockReturnValue(res);
    return res;
};

test('get location weather', async () => {

    const weather = {
        req: {
        },
        header: {
        },
        status: 200,
        text: `{"forecasts":{"forecastLocation":{"forecast":[{"daylight":"D","daySegment":"Morning","description":"More sun than clouds. Cool.","skyInfo":"8","skyDescription":"More sun than clouds","temperature":"10.00","temperatureDesc":"Cool","comfort":"7.65","humidity":"61","dewPoint":"2.80","precipitationProbability":"12","precipitationDesc":"","rainFall":"*","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"17.28","windDirection":"306","windDesc":"Northwest","windDescShort":"NW","beaufortScale":"3","beaufortDescription":"Gentle breeze","visibility":"20.75","icon":"2","iconName":"mostly_sunny","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/2.png","dayOfWeek":"2","weekday":"Monday","utcTime":"2019-12-30T06:00:00.000-03:00"},{"daylight":"D","daySegment":"Afternoon","description":"More sun than clouds. Cool.","skyInfo":"8","skyDescription":"More sun than clouds","temperature":"12.90","temperatureDesc":"Cool","comfort":"10.58","humidity":"51","dewPoint":"3.00","precipitationProbability":"11","precipitationDesc":"","rainFall":"*","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"26.28","windDirection":"312","windDesc":"Northwest","windDescShort":"NW","beaufortScale":"4","beaufortDescription":"Moderate breeze","visibility":"17.46","icon":"2","iconName":"mostly_sunny","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/2.png","dayOfWeek":"2","weekday":"Monday","utcTime":"2019-12-30T12:00:00.000-03:00"},{"daylight":"D","daySegment":"Evening","description":"Mostly sunny. Cool.","skyInfo":"3","skyDescription":"Mostly sunny","temperature":"8.80","temperatureDesc":"Cool","comfort":"5.51","humidity":"58","dewPoint":"1.00","precipitationProbability":"6","precipitationDesc":"","rainFall":"*","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"23.76","windDirection":"288","windDesc":"West","windDescShort":"W","beaufortScale":"4","beaufortDescription":"Moderate breeze","visibility":"16.77","icon":"2","iconName":"mostly_sunny","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/2.png","dayOfWeek":"2","weekday":"Monday","utcTime":"2019-12-30T18:00:00.000-03:00"},{"daylight":"N","daySegment":"Night","description":"Passing clouds. Chilly.","skyInfo":"7","skyDescription":"Passing clouds","temperature":"4.10","temperatureDesc":"Chilly","comfort":"0.40","humidity":"73","dewPoint":"-0.30","precipitationProbability":"3","precipitationDesc":"","rainFall":"*","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"16.56","windDirection":"293","windDesc":"Northwest","windDescShort":"NW","beaufortScale":"3","beaufortDescription":"Gentle breeze","visibility":"8.98","icon":"14","iconName":"night_mostly_clear","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/23.png","dayOfWeek":"2","weekday":"Monday","utcTime":"2019-12-31T00:00:00.000-03:00"},{"daylight":"D","daySegment":"Morning","description":"More clouds than sun. Chilly.","skyInfo":"13","skyDescription":"More clouds than sun","temperature":"4.70","temperatureDesc":"Chilly","comfort":"1.42","humidity":"83","dewPoint":"2.00","precipitationProbability":"9","precipitationDesc":"","rainFall":"*","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"14.76","windDirection":"283","windDesc":"West","windDescShort":"W","beaufortScale":"3","beaufortDescription":"Gentle breeze","visibility":"22.65","icon":"6","iconName":"mostly_cloudy","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/17.png","dayOfWeek":"3","weekday":"Tuesday","utcTime":"2019-12-31T06:00:00.000-03:00"},{"daylight":"D","daySegment":"Afternoon","description":"a few showers. Mostly cloudy. Cool.","skyInfo":"16","skyDescription":"Mostly cloudy","temperature":"13.10","temperatureDesc":"Cool","comfort":"11.25","humidity":"54","dewPoint":"4.00","precipitationProbability":"54","precipitationDesc":"a few showers","rainFall":"0.05","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"20.52","windDirection":"319","windDesc":"Northwest","windDescShort":"NW","beaufortScale":"4","beaufortDescription":"Moderate breeze","visibility":"26.46","icon":"33","iconName":"showers","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/10.png","dayOfWeek":"3","weekday":"Tuesday","utcTime":"2019-12-31T12:00:00.000-03:00"},{"daylight":"D","daySegment":"Evening","description":"a few showers. Mostly cloudy. Cool.","skyInfo":"16","skyDescription":"Mostly cloudy","temperature":"10.80","temperatureDesc":"Cool","comfort":"8.24","humidity":"66","dewPoint":"4.60","precipitationProbability":"68","precipitationDesc":"a few showers","rainFall":"0.05","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"21.60","windDirection":"316","windDesc":"Northwest","windDescShort":"NW","beaufortScale":"4","beaufortDescription":"Moderate breeze","visibility":"10.57","icon":"33","iconName":"showers","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/10.png","dayOfWeek":"3","weekday":"Tuesday","utcTime":"2019-12-31T18:00:00.000-03:00"},{"daylight":"N","daySegment":"Night","description":"Mostly cloudy. Cool.","skyInfo":"16","skyDescription":"Mostly cloudy","temperature":"8.70","temperatureDesc":"Cool","comfort":"5.99","humidity":"72","dewPoint":"3.90","precipitationProbability":"11","precipitationDesc":"","rainFall":"*","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"17.64","windDirection":"316","windDesc":"Northwest","windDescShort":"NW","beaufortScale":"3","beaufortDescription":"Gentle breeze","visibility":"7.07","icon":"17","iconName":"night_mostly_cloudy","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/24.png","dayOfWeek":"3","weekday":"Tuesday","utcTime":"2020-01-01T00:00:00.000-03:00"},{"daylight":"D","daySegment":"Morning","description":"More sun than clouds. Cool.","skyInfo":"8","skyDescription":"More sun than clouds","temperature":"12.70","temperatureDesc":"Cool","comfort":"10.99","humidity":"64","dewPoint":"6.00","precipitationProbability":"11","precipitationDesc":"","rainFall":"*","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"17.64","windDirection":"307","windDesc":"Northwest","windDescShort":"NW","beaufortScale":"3","beaufortDescription":"Gentle breeze","visibility":"15.26","icon":"2","iconName":"mostly_sunny","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/2.png","dayOfWeek":"4","weekday":"Wednesday","utcTime":"2020-01-01T06:00:00.000-03:00"},{"daylight":"D","daySegment":"Afternoon","description":"More sun than clouds. Mild.","skyInfo":"8","skyDescription":"More sun than clouds","temperature":"18.90","temperatureDesc":"Mild","comfort":"18.70","humidity":"47","dewPoint":"7.00","precipitationProbability":"7","precipitationDesc":"","rainFall":"*","snowFall":"*","airInfo":"29","airDescription":"Comfortable","windSpeed":"20.52","windDirection":"316","windDesc":"Northwest","windDescShort":"NW","beaufortScale":"4","beaufortDescription":"Moderate breeze","visibility":"26.20","icon":"2","iconName":"mostly_sunny","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/2.png","dayOfWeek":"4","weekday":"Wednesday","utcTime":"2020-01-01T12:00:00.000-03:00"},{"daylight":"D","daySegment":"Evening","description":"More clouds than sun. Mild.","skyInfo":"13","skyDescription":"More clouds than sun","temperature":"16.90","temperatureDesc":"Mild","comfort":"16.90","humidity":"49","dewPoint":"5.90","precipitationProbability":"10","precipitationDesc":"","rainFall":"*","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"17.64","windDirection":"351","windDesc":"North","windDescShort":"N","beaufortScale":"3","beaufortDescription":"Gentle breeze","visibility":"17.29","icon":"6","iconName":"mostly_cloudy","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/17.png","dayOfWeek":"4","weekday":"Wednesday","utcTime":"2020-01-01T18:00:00.000-03:00"},{"daylight":"N","daySegment":"Night","description":"Sprinkles. Mostly cloudy. Cool.","skyInfo":"16","skyDescription":"Mostly cloudy","temperature":"9.10","temperatureDesc":"Cool","comfort":"11.49","humidity":"58","dewPoint":"5.00","precipitationProbability":"37","precipitationDesc":"Sprinkles","rainFall":"0.06","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"19.08","windDirection":"343","windDesc":"North","windDescShort":"N","beaufortScale":"4","beaufortDescription":"Moderate breeze","visibility":"11.23","icon":"34","iconName":"night_sprinkles","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/22.png","dayOfWeek":"4","weekday":"Wednesday","utcTime":"2020-01-02T00:00:00.000-03:00"},{"daylight":"D","daySegment":"Morning","description":"Sprinkles. More clouds than sun. Cool.","skyInfo":"13","skyDescription":"More clouds than sun","temperature":"14.80","temperatureDesc":"Cool","comfort":"13.32","humidity":"60","dewPoint":"7.00","precipitationProbability":"31","precipitationDesc":"Sprinkles","rainFall":"0.06","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"21.60","windDirection":"205","windDesc":"Southwest","windDescShort":"SW","beaufortScale":"4","beaufortDescription":"Moderate breeze","visibility":"16.24","icon":"18","iconName":"sprinkles","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/27.png","dayOfWeek":"5","weekday":"Thursday","utcTime":"2020-01-02T06:00:00.000-03:00"},{"daylight":"D","daySegment":"Afternoon","description":"a few showers. Mostly cloudy. Cool.","skyInfo":"16","skyDescription":"Mostly cloudy","temperature":"14.70","temperatureDesc":"Cool","comfort":"13.15","humidity":"58","dewPoint":"6.40","precipitationProbability":"37","precipitationDesc":"a few showers","rainFall":"0.06","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"22.32","windDirection":"193","windDesc":"South","windDescShort":"S","beaufortScale":"4","beaufortDescription":"Moderate breeze","visibility":"23.19","icon":"33","iconName":"showers","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/10.png","dayOfWeek":"5","weekday":"Thursday","utcTime":"2020-01-02T12:00:00.000-03:00"},{"daylight":"D","daySegment":"Evening","description":"a few showers. Mostly cloudy. Cool.","skyInfo":"16","skyDescription":"Mostly cloudy","temperature":"9.80","temperatureDesc":"Cool","comfort":"7.36","humidity":"65","dewPoint":"3.40","precipitationProbability":"43","precipitationDesc":"a few showers","rainFall":"0.06","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"17.64","windDirection":"137","windDesc":"Southeast","windDescShort":"SE","beaufortScale":"3","beaufortDescription":"Gentle breeze","visibility":"10.05","icon":"33","iconName":"showers","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/10.png","dayOfWeek":"5","weekday":"Thursday","utcTime":"2020-01-02T18:00:00.000-03:00"},{"daylight":"N","daySegment":"Night","description":"Sprinkles. Passing clouds. Chilly.","skyInfo":"7","skyDescription":"Passing clouds","temperature":"6.00","temperatureDesc":"Chilly","comfort":"3.51","humidity":"75","dewPoint":"2.50","precipitationProbability":"31","precipitationDesc":"Sprinkles","rainFall":"0.06","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"16.56","windDirection":"142","windDesc":"Southeast","windDescShort":"SE","beaufortScale":"3","beaufortDescription":"Gentle breeze","visibility":"9.98","icon":"34","iconName":"night_sprinkles","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/22.png","dayOfWeek":"5","weekday":"Thursday","utcTime":"2020-01-03T00:00:00.000-03:00"},{"daylight":"D","daySegment":"Morning","description":"More sun than clouds. Cool.","skyInfo":"8","skyDescription":"More sun than clouds","temperature":"7.70","temperatureDesc":"Cool","comfort":"4.62","humidity":"70","dewPoint":"2.50","precipitationProbability":"10","precipitationDesc":"","rainFall":"*","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"18.72","windDirection":"164","windDesc":"South","windDescShort":"S","beaufortScale":"4","beaufortDescription":"Moderate breeze","visibility":"19.49","icon":"2","iconName":"mostly_sunny","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/2.png","dayOfWeek":"6","weekday":"Friday","utcTime":"2020-01-03T06:00:00.000-03:00"},{"daylight":"D","daySegment":"Afternoon","description":"a few showers. More clouds than sun. Cool.","skyInfo":"13","skyDescription":"More clouds than sun","temperature":"10.80","temperatureDesc":"Cool","comfort":"7.29","humidity":"64","dewPoint":"4.10","precipitationProbability":"67","precipitationDesc":"a few showers","rainFall":"0.12","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"33.12","windDirection":"185","windDesc":"South","windDescShort":"S","beaufortScale":"5","beaufortDescription":"Fresh breeze","visibility":"20.82","icon":"33","iconName":"showers","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/10.png","dayOfWeek":"6","weekday":"Friday","utcTime":"2020-01-03T12:00:00.000-03:00"},{"daylight":"D","daySegment":"Evening","description":"More sun than clouds. Cool.","skyInfo":"8","skyDescription":"More sun than clouds","temperature":"8.70","temperatureDesc":"Cool","comfort":"5.38","humidity":"63","dewPoint":"2.00","precipitationProbability":"11","precipitationDesc":"","rainFall":"*","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"23.76","windDirection":"218","windDesc":"Southwest","windDescShort":"SW","beaufortScale":"4","beaufortDescription":"Moderate breeze","visibility":"19.31","icon":"2","iconName":"mostly_sunny","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/2.png","dayOfWeek":"6","weekday":"Friday","utcTime":"2020-01-03T18:00:00.000-03:00"},{"daylight":"N","daySegment":"Night","description":"Mostly cloudy. Chilly.","skyInfo":"16","skyDescription":"Mostly cloudy","temperature":"5.70","temperatureDesc":"Chilly","comfort":"1.78","humidity":"74","dewPoint":"1.70","precipitationProbability":"7","precipitationDesc":"","rainFall":"*","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"26.64","windDirection":"304","windDesc":"Northwest","windDescShort":"NW","beaufortScale":"4","beaufortDescription":"Moderate breeze","visibility":"9.95","icon":"17","iconName":"night_mostly_cloudy","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/24.png","dayOfWeek":"6","weekday":"Friday","utcTime":"2020-01-04T00:00:00.000-03:00"},{"daylight":"D","daySegment":"Morning","description":"Sprinkles. Mostly cloudy. Cool.","skyInfo":"16","skyDescription":"Mostly cloudy","temperature":"8.60","temperatureDesc":"Cool","comfort":"5.59","humidity":"67","dewPoint":"2.70","precipitationProbability":"75","precipitationDesc":"Sprinkles","rainFall":"0.12","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"20.16","windDirection":"249","windDesc":"West","windDescShort":"W","beaufortScale":"4","beaufortDescription":"Moderate breeze","visibility":"12.98","icon":"18","iconName":"sprinkles","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/27.png","dayOfWeek":"7","weekday":"Saturday","utcTime":"2020-01-04T06:00:00.000-03:00"},{"daylight":"D","daySegment":"Afternoon","description":"Sprinkles. Mostly cloudy. Cool.","skyInfo":"16","skyDescription":"Mostly cloudy","temperature":"11.90","temperatureDesc":"Cool","comfort":"9.54","humidity":"56","dewPoint":"3.10","precipitationProbability":"38","precipitationDesc":"Sprinkles","rainFall":"0.06","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"21.24","windDirection":"286","windDesc":"West","windDescShort":"W","beaufortScale":"4","beaufortDescription":"Moderate breeze","visibility":"20.11","icon":"18","iconName":"sprinkles","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/27.png","dayOfWeek":"7","weekday":"Saturday","utcTime":"2020-01-04T12:00:00.000-03:00"},{"daylight":"D","daySegment":"Evening","description":"Sprinkles. Mostly cloudy. Cool.","skyInfo":"16","skyDescription":"Mostly cloudy","temperature":"9.50","temperatureDesc":"Cool","comfort":"6.53","humidity":"67","dewPoint":"3.60","precipitationProbability":"50","precipitationDesc":"Sprinkles","rainFall":"0.06","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"22.32","windDirection":"315","windDesc":"Northwest","windDescShort":"NW","beaufortScale":"4","beaufortDescription":"Moderate breeze","visibility":"13.05","icon":"18","iconName":"sprinkles","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/27.png","dayOfWeek":"7","weekday":"Saturday","utcTime":"2020-01-04T18:00:00.000-03:00"},{"daylight":"N","daySegment":"Night","description":"Sprinkles. Mostly cloudy. Cool.","skyInfo":"16","skyDescription":"Mostly cloudy","temperature":"7.10","temperatureDesc":"Cool","comfort":"6.42","humidity":"70","dewPoint":"4.00","precipitationProbability":"34","precipitationDesc":"Sprinkles","rainFall":"0.06","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"19.44","windDirection":"343","windDesc":"North","windDescShort":"N","beaufortScale":"4","beaufortDescription":"Moderate breeze","visibility":"9.29","icon":"34","iconName":"night_sprinkles","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/22.png","dayOfWeek":"7","weekday":"Saturday","utcTime":"2020-01-05T00:00:00.000-03:00"}],"country":"Argentina","state":"Tierra del Fuego","city":"Barrio Almirante Brown","latitude":-54.81667,"longitude":-68.33333,"distance":1.16,"timezone":-3}},"feedCreation":"2019-12-30T11:25:27.211Z","metric":true}`
    }

    const body = JSON.parse(`[{"daylight":"D","daySegment":"Morning","description":"More sun than clouds. Cool.","skyInfo":"8","skyDescription":"More sun than clouds","temperature":"10.00","temperatureDesc":"Cool","comfort":"7.65","humidity":"61","dewPoint":"2.80","precipitationProbability":"12","precipitationDesc":"","rainFall":"*","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"17.28","windDirection":"306","windDesc":"Northwest","windDescShort":"NW","beaufortScale":"3","beaufortDescription":"Gentle breeze","visibility":"20.75","icon":"2","iconName":"mostly_sunny","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/2.png","dayOfWeek":"2","weekday":"Monday","utcTime":"2019-12-30T06:00:00.000-03:00"},{"daylight":"N","daySegment":"Night","description":"Passing clouds. Chilly.","skyInfo":"7","skyDescription":"Passing clouds","temperature":"4.10","temperatureDesc":"Chilly","comfort":"0.40","humidity":"73","dewPoint":"-0.30","precipitationProbability":"3","precipitationDesc":"","rainFall":"*","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"16.56","windDirection":"293","windDesc":"Northwest","windDescShort":"NW","beaufortScale":"3","beaufortDescription":"Gentle breeze","visibility":"8.98","icon":"14","iconName":"night_mostly_clear","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/23.png","dayOfWeek":"2","weekday":"Monday","utcTime":"2019-12-31T00:00:00.000-03:00"},{"daylight":"N","daySegment":"Night","description":"Mostly cloudy. Cool.","skyInfo":"16","skyDescription":"Mostly cloudy","temperature":"8.70","temperatureDesc":"Cool","comfort":"5.99","humidity":"72","dewPoint":"3.90","precipitationProbability":"11","precipitationDesc":"","rainFall":"*","snowFall":"*","airInfo":"*","airDescription":"","windSpeed":"17.64","windDirection":"316","windDesc":"Northwest","windDescShort":"NW","beaufortScale":"3","beaufortDescription":"Gentle breeze","visibility":"7.07","icon":"17","iconName":"night_mostly_cloudy","iconLink":"https://weather.ls.hereapi.com/static/weather/icon/24.png","dayOfWeek":"3","weekday":"Tuesday","utcTime":"2020-01-01T00:00:00.000-03:00"}]`);

    weatherService.getWeather.mockResolvedValue(weather);

    const controller = require('../controllers/weatherController');
    
    const req = mockRequest(-54.814577, -68.323605);
    const res = mockResponse();

    await controller.weather_get(req, res);

    return expect(res.json).toHaveBeenCalledWith(body);
});